# import CreateServiceInput from "./schema.graphql"

fragment Service on Service {
  id
  name
  current_go_live_stage
}

fragment GatewayAccount on GatewayAccount {
  id
  type
  payment_provider
  credentials {
    ... on BamboraCredentials {
      merchant_id
      account_number
      api_username
    }
  }
}

fragment GatewayAccountCredentials on GatewayAccountCredentials {
  ... on BamboraCredentials {
    merchant_id
    account_number
    api_username
  }
}

fragment Product on Product {
  id
  name
  name_slug
  service_name_slug
  description
}

fragment Payment on Payment {
  id
  inserted_at
  updated_at
  status
  amount
  reference
  description
  email
  gateway_transaction_id
  card_details {
    cardholder_name
    card_number
    last_digits_card_number
    first_digits_card_number
    expiry_date
    card_brand
  }
}

fragment PaymentEvent on PaymentEvent {
  id
  inserted_at
  updated_at
  type
  status
}

fragment PaymentRefund on PaymentRefund {
  id
  reference
  amount
  status
  user_external_id
  gateway_transaction_id
}

query GetUserServices($userId: ID!) {
  services: userServices(userId: $userId)
    @rest(
      type: "Service"
      path: "/internal/services/users/{args.userId}/services"
    ) {
    ...Service
  }
}

query GetService($id: ID!) {
  service(id: $id)
    @rest(type: "Service", path: "/internal/services/services/{args.id}") {
    ...Service
  }
}

query GetServiceWithUsers($id: ID!) {
  service(id: $id)
    @rest(type: "Service", path: "/internal/services/services/{args.id}") {
    id @export(as: "id")
    ...Service
    users
      @rest(
        type: "[ServiceUser]"
        path: "/internal/services/services/{exportVariables.id}/service-users"
      ) {
      user {
        id
        name
        email
      }
      role {
        name
      }
    }
  }
}

query GetServiceWithGatewayAccounts($id: ID!) {
  service(id: $id)
    @rest(type: "Service", path: "/internal/services/services/{args.id}") {
    id @export(as: "id")
    ...Service
    gateway_accounts
      @rest(
        type: "[GatewayAccount]"
        path: "/internal/services/services/{exportVariables.id}/gateway-accounts"
      ) {
      ...GatewayAccount
    }
  }
}

mutation CreateService($input: CreateServiceInput!) {
  service: createService(input: $input)
    @rest(
      type: "Service"
      path: "/internal/services/services"
      method: "POST"
    ) {
    ...Service
  }
}

mutation UpdateService($id: ID!, $input: UpdateServiceInput!) {
  service: updateService(id: $id, input: $input)
    @rest(
      type: "Service"
      path: "/internal/services/services/{args.id}"
      method: "PUT"
    ) {
    ...Service
  }
}

mutation SubmitRefund($paymentId: ID!, $input: SubmitRefundInput!) {
  refund: submitRefund(paymentId: $paymentId, input: $input)
    @rest(
      type: "PaymentRefund"
      path: "/internal/payments/payments/{args.paymentId}/refunds"
      method: "POST"
    ) {
    ...PaymentRefund
  }
}

query GetGatewayAccounts($serviceId: ID!) {
  gatewayAccounts(serviceId: $serviceId)
    @rest(
      type: "[GatewayAccount]"
      path: "/internal/services/services/{args.serviceId}/gateway-accounts"
    ) {
    ...GatewayAccount
  }
}

query GetGatewayAccount($id: ID!) {
  gatewayAccount(id: $id)
    @rest(
      type: "GatewayAccount"
      path: "/internal/payments/gateway-accounts/{args.id}"
    ) {
    ...GatewayAccount
  }
}

mutation UpdateGatewayAccountCredentials(
  $gatewayAccountId: ID!
  $input: UpdateGatewayAccountCredentialsInput!
) {
  credentials: updateGatewayAccountCredentials(
    gatewayAccountId: $gatewayAccountId
    input: $input
  )
    @rest(
      type: "GatewayAccountCredentials"
      path: "/internal/payments/gateway-accounts/{args.gatewayAccountId}/credentials"
      method: "PUT"
    ) {
    ...GatewayAccountCredentials
  }
}

query GetProducts($gatewayAccountId: ID!) {
  products(gatewayAccountId: $gatewayAccountId)
    @rest(
      type: "[Product]"
      path: "/internal/products/gateway-accounts/{args.gatewayAccountId}/products"
    ) {
    ...Product
  }
}

mutation CreateProduct($gatewayAccountId: ID!, $input: CreateProductInput!) {
  product: createProduct(gatewayAccountId: $gatewayAccountId, input: $input)
    @rest(
      type: "Product"
      path: "/internal/products/gateway-accounts/{args.gatewayAccountId}/products"
      method: "POST"
    ) {
    ...Service
  }
}

query GetPayments($gatewayAccountId: ID!) {
  payments(gatewayAccountId: $gatewayAccountId)
    @rest(
      type: "[Payment]"
      path: "/internal/services/gateway-accounts/{args.gatewayAccountId}/payments"
    ) {
    ...Payment
  }
}

query GetPayment($id: ID!) {
  payment(id: $id)
    @rest(type: "Payment", path: "/internal/payments/payments/{args.id}") {
    ...Payment
  }
}

query GetPaymentEvents($paymentId: ID!) {
  events: paymentEvents(paymentId: $paymentId)
    @rest(
      type: "[PaymentEvent]"
      path: "/internal/payments/payments/{args.paymentId}/events"
    ) {
    ...PaymentEvent
  }
}
